(()=>{"use strict";var e=document.querySelector("#card-template").content;function t(t,n,r,o,c){var a=e.querySelector(".card").cloneNode(!0),i=a.querySelector(".card__image"),u=a.querySelector(".card__title"),s=document.querySelector(".popup_type_image"),l=s.querySelector(".popup__image"),d=s.querySelector(".popup__caption"),f=a.querySelector(".card__number-of-likes"),p=a.querySelector(".card__delete-button"),m=a.querySelector(".card__like-button");o!==t.owner._id&&(p.hidden=!0);var v=t._id;return i.src=t.link,i.alt=t.name,u.textContent=t.name,f.textContent=t.likes.length,t.likes.some((function(e){return e._id===o}))&&m.classList.add("card__like-button_is-active"),m.addEventListener("click",(function(){return c(function(e){return e.classList.contains("card__like-button_is-active")}(m),f,m,v)})),p.addEventListener("click",(function(){return n(a,v)})),i.addEventListener("click",(function(){return r(i,s,l,d)})),a}function n(e,t,n){n.classList.toggle("card__like-button_is-active"),t.textContent=e.likes.length}function r(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",c)}function o(e){e.classList.remove("popup_is-opened"),document.removeEventListener("click",c)}function c(e){"Escape"===e.key&&o(document.querySelector(".popup_is-opened"))}var a={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},i=function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""};function u(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))}function s(e,t){Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(n){i(e,n,t)}));var n=e.querySelector(t.submitButtonSelector);n.disabled=!0,n.classList.add(t.inactiveButtonClass)}var l={baseUrl:"https://nomoreparties.co/v1/wff-cohort-15",headers:{authorization:"a8cb1b2a-4431-497b-bdfb-7d64af336a26","Content-Type":"application/json"}};function d(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var f=document.querySelectorAll(".popup"),p=document.forms["edit-profile"],m=p.elements.name,v=p.elements.description,h=document.querySelector(".profile__title"),y=document.querySelector(".profile__description"),_=document.querySelector(".profile__image"),b=document.forms["new-place"],S=b.elements.link,g=b.elements["place-name"],E=document.forms["edit-avatar"],C=E.elements.avatar,L="Сохранение...",q="Сохранить";function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var A=document.querySelector(".places__list"),x=document.querySelector(".popup_type_edit"),T=document.querySelector(".popup_type_new-card"),U=document.querySelector(".popup_type_avatar"),w=document.querySelector(".profile__edit-button"),j=document.querySelector(".profile__add-button");function O(e,t,n,o){n.src=e.src,n.alt=e.alt,o.textContent=e.alt,r(t)}function B(e,t){e.textContent=t}function P(e,t,r,o){e?function(e){return fetch("".concat(l.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:l.headers}).then((function(e){return d(e)}))}(o).then((function(e){return n(e,t,r)})).catch((function(e){return console.log(e)})):function(e){return fetch("".concat(l.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:l.headers}).then((function(e){return d(e)}))}(o).then((function(e){return n(e,t,r)})).catch((function(e){return console.log(e)}))}function D(e,t){(function(e){return fetch("".concat(l.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:l.headers}).then((function(e){return d(e)}))})(t).then((function(){return function(e){e.remove()}(e)})).catch((function(e){return console.log(e)}))}!function(e,t,n,o){e.addEventListener("click",(function(){m.value=h.textContent,v.value=y.textContent,r(t),s(o,n)}))}(w,x,a,p),function(e,t,n,o){e.addEventListener("click",(function(){o.reset(),r(t),s(o,n)}))}(j,T,a,b),function(e,t,n,o){e.addEventListener("click",(function(){o.reset(),r(t),s(o,n)}))}(_,U,a,E),p.addEventListener("submit",(function(e){var t,n;e.preventDefault(),B(e.submitter,L),(t=m.value,n=v.value,fetch("".concat(l.baseUrl,"/users/me"),{method:"PATCH",headers:l.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return d(e)}))).then((function(){h.textContent=m.value,y.textContent=v.value})).catch((function(e){console.log(e)})).finally((function(){B(e.submitter,q),o(x)}))})),b.addEventListener("submit",(function(e){var n;e.preventDefault(),B(e.submitter,L),(n={name:g.value,link:S.value},fetch("".concat(l.baseUrl,"/cards"),{method:"POST",headers:l.headers,body:JSON.stringify(n)}).then((function(e){return d(e)}))).then((function(e){var n=e.owner._id;A.prepend(t(e,D,O,n,P)),b.reset()})).catch((function(e){console.log(e)})).finally((function(){B(e.submitter,q),o(T)}))})),E.addEventListener("submit",(function(e){var t;e.preventDefault(),B(e.submitter,L),(t={avatar:C.value},fetch("".concat(l.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:l.headers,body:JSON.stringify(t)}).then((function(e){return d(e)}))).then((function(e){_.style.backgroundImage="url('".concat(e.avatar,"')"),E.reset()})).catch((function(e){console.log(e)})).finally((function(){B(e.submitter,q),o(U)}))})),Promise.all([fetch("".concat(l.baseUrl,"/users/me"),{method:"GET",headers:l.headers}).then((function(e){return d(e)})),fetch("".concat(l.baseUrl,"/cards"),{method:"GET",headers:l.headers}).then((function(e){return d(e)}))]).then((function(e){var n,r,o=(r=2,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,a,i=[],u=!0,s=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){s=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw o}}return i}}(n,r)||function(e,t){if(e){if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?k(e,t):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],a=o[1];h.textContent=c.name,y.textContent=c.about,_.style.backgroundImage="url('".concat(c.avatar,"')");var i=c._id;a.forEach((function(e){A.append(t(e,D,O,i,P))}))})).catch((function(e){console.log(e)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);u(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?i(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(e,o,t),u(n,r,t)}))}))}(t,e)}))}(a),f.forEach((function(e){e.classList.add("popup_is-animated"),e.addEventListener("click",(function(t){(t.target===t.currentTarget||t.target.classList.contains("popup__close"))&&o(e)}))}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEVBQU1QLGlCQUFpQixTQUFTLFNBQUNZLElBQzNCQSxFQUFNMEcsU0FBVzFHLEVBQU0yRyxlQUFpQjNHLEVBQU0wRyxPQUFPeEgsVUFBVUcsU0FBUyxrQkFDMUVRLEVBQVdGLEVBRWYsR0FDRixHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbWVzdG8tcHJvamVjdC1mZi8uL3NyYy9jb21wb25lbnRzL2NhcmQuanMiLCJ3ZWJwYWNrOi8vbWVzdG8tcHJvamVjdC1mZi8uL3NyYy9jb21wb25lbnRzL21vZGFsLmpzIiwid2VicGFjazovL21lc3RvLXByb2plY3QtZmYvLi9zcmMvY29tcG9uZW50cy92YWxpZGF0aW9uLmpzIiwid2VicGFjazovL21lc3RvLXByb2plY3QtZmYvLi9zcmMvY29tcG9uZW50cy9hcGkuanMiLCJ3ZWJwYWNrOi8vbWVzdG8tcHJvamVjdC1mZi8uL3NyYy9jb21wb25lbnRzL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly9tZXN0by1wcm9qZWN0LWZmLy4vc3JjL3NjcmlwdHMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgY2FyZFRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2NhcmQtdGVtcGxhdGUnKS5jb250ZW50O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUNhcmQgKGl0ZW0sIGhhbmRsZURlbGV0ZUNhcmQsIG9wZW5JbWFnZU1vZGFsLCBjdXJyZW50VXNlcklkLCBoYW5kbGVMaWtlQ2FyZCkge1xyXG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZFRlbXBsYXRlLnF1ZXJ5U2VsZWN0b3IoJy5jYXJkJykuY2xvbmVOb2RlKHRydWUpO1xyXG5cclxuICBjb25zdCBjYXJkSW1hZ2UgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9faW1hZ2UnKTtcclxuICBjb25zdCBjYXJkVGl0bGUgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fdGl0bGUnKTtcclxuICBjb25zdCBtb2RhbEltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX3R5cGVfaW1hZ2UnKTtcclxuICBjb25zdCBwb3B1cEltYWdlID0gbW9kYWxJbWFnZS5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2ltYWdlJyk7XHJcbiAgY29uc3QgcG9wdXBDYXB0aW9uID0gbW9kYWxJbWFnZS5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2NhcHRpb24nKTtcclxuICBjb25zdCBjYXJkTnVtYmVyT2ZMaWtlcyA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19udW1iZXItb2YtbGlrZXMnKTtcclxuICBjb25zdCBkZWxldGVCdXR0b24gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fZGVsZXRlLWJ1dHRvbicpO1xyXG4gIGNvbnN0IGNhcmRMaWtlQnV0dG9uID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcignLmNhcmRfX2xpa2UtYnV0dG9uJyk7XHJcblxyXG4gIGlmIChjdXJyZW50VXNlcklkICE9PSBpdGVtLm93bmVyLl9pZCl7XHJcbiAgICBkZWxldGVCdXR0b24uaGlkZGVuID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGNhcmRJZCA9IGl0ZW0uX2lkO1xyXG4gIGNhcmRJbWFnZS5zcmMgPSBpdGVtLmxpbms7XHJcbiAgY2FyZEltYWdlLmFsdCA9IGl0ZW0ubmFtZTtcclxuICBjYXJkVGl0bGUudGV4dENvbnRlbnQgPSBpdGVtLm5hbWU7XHJcbiAgY2FyZE51bWJlck9mTGlrZXMudGV4dENvbnRlbnQgPSBpdGVtLmxpa2VzLmxlbmd0aDtcclxuXHJcbiAgY29uc3QgbGlrZUl0ID0gaXRlbS5saWtlcy5zb21lKGxpa2UgPT4gbGlrZS5faWQgPT09IGN1cnJlbnRVc2VySWQpO1xyXG4gIGlmIChsaWtlSXQpIHtcclxuICAgIGNhcmRMaWtlQnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2NhcmRfX2xpa2UtYnV0dG9uX2lzLWFjdGl2ZScpO1xyXG4gIH1cclxuXHJcbiAgY2FyZExpa2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBoYW5kbGVMaWtlQ2FyZChjaGVja1N0YXR1c0xpa2UoY2FyZExpa2VCdXR0b24pLCBjYXJkTnVtYmVyT2ZMaWtlcywgY2FyZExpa2VCdXR0b24sIGNhcmRJZCkpO1xyXG4gIGRlbGV0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IGhhbmRsZURlbGV0ZUNhcmQoY2FyZEVsZW1lbnQsIGNhcmRJZCkpO1xyXG4gIGNhcmRJbWFnZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IG9wZW5JbWFnZU1vZGFsKGNhcmRJbWFnZSwgbW9kYWxJbWFnZSwgcG9wdXBJbWFnZSwgcG9wdXBDYXB0aW9uKSk7XHJcblxyXG4gIHJldHVybiBjYXJkRWxlbWVudDtcclxufVxyXG5cclxuZnVuY3Rpb24gY2hlY2tTdGF0dXNMaWtlKGNhcmRMaWtlQnV0dG9uKSB7IFxyXG4gIHJldHVybiBjYXJkTGlrZUJ1dHRvbi5jbGFzc0xpc3QuY29udGFpbnMoJ2NhcmRfX2xpa2UtYnV0dG9uX2lzLWFjdGl2ZScpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY2hhbmdlTGlrZShyZXMsIGNhcmROdW1iZXJPZkxpa2VzLCBjYXJkTGlrZUJ1dHRvbikge1xyXG4gIGNhcmRMaWtlQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoJ2NhcmRfX2xpa2UtYnV0dG9uX2lzLWFjdGl2ZScpO1xyXG4gIGNhcmROdW1iZXJPZkxpa2VzLnRleHRDb250ZW50ID0gcmVzLmxpa2VzLmxlbmd0aDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGRlbGV0ZUNhcmQoY2FyZCkge1xyXG4gIGNhcmQucmVtb3ZlKClcclxufSIsImV4cG9ydCBmdW5jdGlvbiBtb2RhbE9wZW4obW9kYWwpIHtcclxuICBtb2RhbC5jbGFzc0xpc3QuYWRkKCdwb3B1cF9pcy1vcGVuZWQnKTtcclxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgbW9kYWxDbG9zZUVzYyk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBtb2RhbENsb3NlKG1vZGFsKSB7XHJcbiAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgncG9wdXBfaXMtb3BlbmVkJyk7XHJcbiAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBtb2RhbENsb3NlRXNjKTtcclxufVxyXG5cclxuZnVuY3Rpb24gbW9kYWxDbG9zZUVzYyAoZXZlbnQpIHtcclxuICBpZiAoZXZlbnQua2V5ID09PSAnRXNjYXBlJykge1xyXG4gICAgY29uc3Qgb3BlbmVkUG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfaXMtb3BlbmVkJyk7XHJcbiAgICBtb2RhbENsb3NlKG9wZW5lZFBvcHVwKTtcclxuICB9XHJcbn0iLCJleHBvcnQgY29uc3QgdmFsaWRhdGlvbkVsZW1lbnRzID0ge1xyXG4gIGZvcm1TZWxlY3RvcjogJy5wb3B1cF9fZm9ybScsXHJcbiAgaW5wdXRTZWxlY3RvcjogJy5wb3B1cF9faW5wdXQnLFxyXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiAnLnBvcHVwX19idXR0b24nLFxyXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6ICdwb3B1cF9fYnV0dG9uX2Rpc2FibGVkJyxcclxuICBpbnB1dEVycm9yQ2xhc3M6ICdwb3B1cF9faW5wdXRfdHlwZV9lcnJvcicsXHJcbiAgZXJyb3JDbGFzczogJ3BvcHVwX19lcnJvcl92aXNpYmxlJ1xyXG59O1xyXG5cclxuZnVuY3Rpb24gc2hvd0lucHV0RXJyb3IgKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGVycm9yTWVzc2FnZSwgdmFsaWRhdGlvbkVsZW1lbnRzKSB7XHJcbiAgY29uc3QgZXJyb3JFbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgLiR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApO1xyXG4gIGlucHV0RWxlbWVudC5jbGFzc0xpc3QuYWRkKHZhbGlkYXRpb25FbGVtZW50cy5pbnB1dEVycm9yQ2xhc3MpO1xyXG4gIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IGVycm9yTWVzc2FnZTtcclxuICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LmFkZCh2YWxpZGF0aW9uRWxlbWVudHMuZXJyb3JDbGFzcyk7XHJcbn1cclxuXHJcbmNvbnN0IGhpZGVJbnB1dEVycm9yID0gKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIHZhbGlkYXRpb25FbGVtZW50cykgPT4ge1xyXG4gIGNvbnN0IGVycm9yRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcclxuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh2YWxpZGF0aW9uRWxlbWVudHMuaW5wdXRFcnJvckNsYXNzKTtcclxuICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh2YWxpZGF0aW9uRWxlbWVudHMuZXJyb3JDbGFzcyk7XHJcbiAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gJyc7XHJcbn07XHJcblxyXG5mdW5jdGlvbiBjaGVja0lucHV0VmFsaWRpdHkgKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIHZhbGlkYXRpb25FbGVtZW50cykge1xyXG4gIGlmKGlucHV0RWxlbWVudC52YWxpZGl0eS5wYXR0ZXJuTWlzbWF0Y2gpIHtcclxuICAgIGlucHV0RWxlbWVudC5zZXRDdXN0b21WYWxpZGl0eShpbnB1dEVsZW1lbnQuZGF0YXNldC5lcnJvck1lc3NhZ2UpO1xyXG4gIH0gXHJcbiAgZWxzZSB7XHJcbiAgICBpbnB1dEVsZW1lbnQuc2V0Q3VzdG9tVmFsaWRpdHkoXCJcIik7XHJcbiAgfVxyXG5cclxuICBpZighaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSAge1xyXG4gICAgc2hvd0lucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlLCB2YWxpZGF0aW9uRWxlbWVudHMpO1xyXG4gIH1cclxuICBlbHNlIHtcclxuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIHZhbGlkYXRpb25FbGVtZW50cyk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBzZXRFdmVudExpc3RlbmVycyAoZm9ybUVsZW1lbnQsIHZhbGlkYXRpb25FbGVtZW50cykge1xyXG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCh2YWxpZGF0aW9uRWxlbWVudHMuaW5wdXRTZWxlY3RvcikpO1xyXG4gIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKHZhbGlkYXRpb25FbGVtZW50cy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XHJcbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCB2YWxpZGF0aW9uRWxlbWVudHMpO1xyXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIHZhbGlkYXRpb25FbGVtZW50cyk7XHJcbiAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgdmFsaWRhdGlvbkVsZW1lbnRzKTtcclxuICAgIH0pXHJcbiAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhc0ludmFsaWRJbnB1dChpbnB1dExpc3QpIHtcclxuICByZXR1cm4gaW5wdXRMaXN0LnNvbWUoKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgcmV0dXJuICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQ7XHJcbiAgfSlcclxufVxyXG5cclxuZnVuY3Rpb24gdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCB2YWxpZGF0aW9uRWxlbWVudHMpIHtcclxuICBpZiAoaGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkpIHtcclxuICAgICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQodmFsaWRhdGlvbkVsZW1lbnRzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gIH1cclxuICBlbHNlIHtcclxuICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh2YWxpZGF0aW9uRWxlbWVudHMuaW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZW5hYmxlVmFsaWRhdGlvbih2YWxpZGF0aW9uRWxlbWVudHMpIHtcclxuICBjb25zdCBmb3JtTGlzdCA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCh2YWxpZGF0aW9uRWxlbWVudHMuZm9ybVNlbGVjdG9yKSk7XHJcbiAgZm9ybUxpc3QuZm9yRWFjaChmb3JtRWxlbWVudCA9PiB7XHJcbiAgICBzZXRFdmVudExpc3RlbmVycyhmb3JtRWxlbWVudCwgdmFsaWRhdGlvbkVsZW1lbnRzKTtcclxuICB9KVxyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNsZWFyVmFsaWRhdGlvbihmb3JtRWxlbWVudCwgdmFsaWRhdGlvbkVsZW1lbnRzKSB7XHJcbiAgY29uc3QgaW5wdXRsaXN0ID0gQXJyYXkuZnJvbShmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHZhbGlkYXRpb25FbGVtZW50cy5pbnB1dFNlbGVjdG9yKSk7XHJcbiAgaW5wdXRsaXN0LmZvckVhY2goaW5wdXRFbGVtZW50ID0+IHtcclxuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIHZhbGlkYXRpb25FbGVtZW50cylcclxuICB9KVxyXG5cclxuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3Rvcih2YWxpZGF0aW9uRWxlbWVudHMuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xyXG4gIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlO1xyXG4gIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZCh2YWxpZGF0aW9uRWxlbWVudHMuaW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbn1cclxuIiwiY29uc3QgY29uZmlnID0ge1xyXG4gIGJhc2VVcmw6ICdodHRwczovL25vbW9yZXBhcnRpZXMuY28vdjEvd2ZmLWNvaG9ydC0xNScsXHJcbiAgaGVhZGVyczoge1xyXG4gICAgYXV0aG9yaXphdGlvbjogJ2E4Y2IxYjJhLTQ0MzEtNDk3Yi1iZGZiLTdkNjRhZjMzNmEyNicsXHJcbiAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBjaGVja1Jlc3BvbnNlKHJlcykge1xyXG4gIHJldHVybiByZXMub2sgPyByZXMuanNvbigpIDogUHJvbWlzZS5yZWplY3QoYNCe0YjQuNCx0LrQsDogJHtyZXMuc3RhdHVzfWApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0VXNlckRhdGEoKXtcclxuICByZXR1cm4gZmV0Y2goYCR7Y29uZmlnLmJhc2VVcmx9L3VzZXJzL21lYCwge1xyXG4gICAgbWV0aG9kOiAnR0VUJyxcclxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzLFxyXG4gIH0pXHJcbiAgLnRoZW4ocmVzID0+IGNoZWNrUmVzcG9uc2UocmVzKSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRDYXJkcygpIHtcclxuICByZXR1cm4gZmV0Y2goYCR7Y29uZmlnLmJhc2VVcmx9L2NhcmRzYCwge1xyXG4gICAgbWV0aG9kOiAnR0VUJyxcclxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzLFxyXG4gIH0pXHJcbiAgLnRoZW4ocmVzID0+IGNoZWNrUmVzcG9uc2UocmVzKSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBlZGl0UHJvZmlsZUluZm9ybWF0aW9uKG5hbWUsIGFib3V0KSB7XHJcbiAgcmV0dXJuIGZldGNoKGAke2NvbmZpZy5iYXNlVXJsfS91c2Vycy9tZWAsIHtcclxuICAgIG1ldGhvZDogJ1BBVENIJyxcclxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzLFxyXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe25hbWUsIGFib3V0fSlcclxuICB9KVxyXG4gIC50aGVuKHJlcyA9PiBjaGVja1Jlc3BvbnNlKHJlcykpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2VuZE5ld0NhcmQobmV3Q2FyZCkge1xyXG4gIHJldHVybiBmZXRjaChgJHtjb25maWcuYmFzZVVybH0vY2FyZHNgLHtcclxuICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeShuZXdDYXJkKSxcclxuICB9KVxyXG4gIC50aGVuKHJlcyA9PiBjaGVja1Jlc3BvbnNlKHJlcykpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZGVsZXRlQ2FyZFJlcXVlc3QoY2FyZElkKXtcclxuICByZXR1cm4gZmV0Y2goYCR7Y29uZmlnLmJhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfWAse1xyXG4gICAgbWV0aG9kOiAnREVMRVRFJyxcclxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzLFxyXG4gIH0pXHJcbiAgLnRoZW4ocmVzID0+IGNoZWNrUmVzcG9uc2UocmVzKSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBwdXRMaWtlQ2FyZChjYXJkSWQpe1xyXG4gIHJldHVybiBmZXRjaChgJHtjb25maWcuYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCx7XHJcbiAgICBtZXRob2Q6ICdQVVQnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgfSlcclxuICAudGhlbihyZXMgPT4gY2hlY2tSZXNwb25zZShyZXMpKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHJlbW92ZUxpa2UoY2FyZElkKXtcclxucmV0dXJuIGZldGNoKGAke2NvbmZpZy5iYXNlVXJsfS9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLHtcclxuICAgIG1ldGhvZDogJ0RFTEVURScsXHJcbiAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVycyxcclxuICB9KVxyXG4gIC50aGVuKHJlcyA9PiBjaGVja1Jlc3BvbnNlKHJlcykpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlUHJvZmlsZUF2YXRhcihhdmF0YXIpe1xyXG4gIHJldHVybiBmZXRjaChgJHtjb25maWcuYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xyXG4gICAgbWV0aG9kOiAnUEFUQ0gnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeShhdmF0YXIpLFxyXG4gIH0pXHJcbiAgLnRoZW4ocmVzID0+IGNoZWNrUmVzcG9uc2UocmVzKSk7XHJcbn0iLCJleHBvcnQge3Byb2ZpbGVGb3JtRWxlbWVudCwgbmFtZUlucHV0LCBqb2JJbnB1dCxcclxuICAgICAgICBwcm9maWxlVGl0bGUsIHByb2ZpbGVEZXNjcmlwdGlvbiwgcHJvZmlsZUltYWdlLFxyXG4gICAgICAgIGZvcm1BZGRDYXJkLCBsaW5rSW5wdXQsIHBsYWNlTmFtZWlucHV0LFxyXG4gICAgICAgIHBvcHVwcywgYXZhdGFyRm9ybUVsZW1lbnQsIGxpbmtBdmF0YXJpbnB1dCwgcmVuZGVyTG9hZGluZ1N0YXR1c31cclxuXHJcbmNvbnN0IHBvcHVwcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wb3B1cCcpO1xyXG5cclxuY29uc3QgcHJvZmlsZUZvcm1FbGVtZW50ID0gZG9jdW1lbnQuZm9ybXNbJ2VkaXQtcHJvZmlsZSddO1xyXG5jb25zdCBuYW1lSW5wdXQgPSBwcm9maWxlRm9ybUVsZW1lbnQuZWxlbWVudHMubmFtZTtcclxuY29uc3Qgam9iSW5wdXQgPSBwcm9maWxlRm9ybUVsZW1lbnQuZWxlbWVudHMuZGVzY3JpcHRpb247XHJcbmNvbnN0IHByb2ZpbGVUaXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX190aXRsZScpO1xyXG5jb25zdCBwcm9maWxlRGVzY3JpcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fZGVzY3JpcHRpb24nKTtcclxuY29uc3QgcHJvZmlsZUltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2ltYWdlJyk7XHJcblxyXG5jb25zdCBmb3JtQWRkQ2FyZCA9IGRvY3VtZW50LmZvcm1zWyduZXctcGxhY2UnXTtcclxuY29uc3QgbGlua0lucHV0ID0gZm9ybUFkZENhcmQuZWxlbWVudHMubGluaztcclxuY29uc3QgcGxhY2VOYW1laW5wdXQgPSBmb3JtQWRkQ2FyZC5lbGVtZW50c1sncGxhY2UtbmFtZSddO1xyXG5cclxuY29uc3QgYXZhdGFyRm9ybUVsZW1lbnQgPSBkb2N1bWVudC5mb3Jtc1snZWRpdC1hdmF0YXInXTtcclxuY29uc3QgbGlua0F2YXRhcmlucHV0ID0gYXZhdGFyRm9ybUVsZW1lbnQuZWxlbWVudHMuYXZhdGFyO1xyXG5cclxuY29uc3QgcmVuZGVyTG9hZGluZ1N0YXR1cyA9IHtcclxuICAgICAgICBzYXZpbmcgOiAn0KHQvtGF0YDQsNC90LXQvdC40LUuLi4nLFxyXG4gICAgICAgIHNhdmUgOiAn0KHQvtGF0YDQsNC90LjRgtGMJ1xyXG4gICAgICB9IiwiaW1wb3J0ICcuLi9wYWdlcy9pbmRleC5jc3MnO1xyXG5pbXBvcnQge2NyZWF0ZUNhcmQsIGRlbGV0ZUNhcmQsIGNoYW5nZUxpa2V9IGZyb20gJy4uL2NvbXBvbmVudHMvY2FyZC5qcyc7XHJcbmltcG9ydCB7bW9kYWxPcGVuLCBtb2RhbENsb3NlfSBmcm9tICcuLi9jb21wb25lbnRzL21vZGFsLmpzJztcclxuaW1wb3J0IHtlbmFibGVWYWxpZGF0aW9uLCB2YWxpZGF0aW9uRWxlbWVudHMsIGNsZWFyVmFsaWRhdGlvbn0gZnJvbSAnLi4vY29tcG9uZW50cy92YWxpZGF0aW9uLmpzJztcclxuaW1wb3J0IHtnZXRVc2VyRGF0YSwgZ2V0Q2FyZHMsIGVkaXRQcm9maWxlSW5mb3JtYXRpb24sIHNlbmROZXdDYXJkLCB1cGRhdGVQcm9maWxlQXZhdGFyLCByZW1vdmVMaWtlLCBwdXRMaWtlQ2FyZCwgZGVsZXRlQ2FyZFJlcXVlc3R9IGZyb20gJy4uL2NvbXBvbmVudHMvYXBpLmpzJztcclxuaW1wb3J0IHtcclxuICBwb3B1cHMsIHByb2ZpbGVGb3JtRWxlbWVudCwgZm9ybUFkZENhcmQsIGF2YXRhckZvcm1FbGVtZW50LCBcclxuICBwcm9maWxlVGl0bGUsIHByb2ZpbGVEZXNjcmlwdGlvbiwgcHJvZmlsZUltYWdlLCBuYW1lSW5wdXQsIFxyXG4gIGpvYklucHV0LCByZW5kZXJMb2FkaW5nU3RhdHVzLCBsaW5rQXZhdGFyaW5wdXQsXHJcbiAgcGxhY2VOYW1laW5wdXQsIGxpbmtJbnB1dFxyXG59IGZyb20gJy4uL2NvbXBvbmVudHMvY29uc3RhbnRzLmpzJztcclxuXHJcblxyXG5jb25zdCBwbGFjZXNMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBsYWNlc19fbGlzdCcpO1xyXG5jb25zdCBwb3B1cFByb2ZpbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfdHlwZV9lZGl0Jyk7XHJcbmNvbnN0IHBvcHVwTmV3Q2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF90eXBlX25ldy1jYXJkJyk7XHJcbmNvbnN0IHBvcHVwQXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX3R5cGVfYXZhdGFyJyk7XHJcbmNvbnN0IHByb2ZpbGVFZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2VkaXQtYnV0dG9uJyk7XHJcbmNvbnN0IHByb2ZpbGVBZGRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fYWRkLWJ1dHRvbicpO1xyXG5cclxub3BlblByb2ZpbGVNb2RhbChwcm9maWxlRWRpdEJ1dHRvbiwgcG9wdXBQcm9maWxlLCB2YWxpZGF0aW9uRWxlbWVudHMsIHByb2ZpbGVGb3JtRWxlbWVudCk7XHJcbm9wZW5BZGRDYXJkTW9kYWwocHJvZmlsZUFkZEJ1dHRvbiwgcG9wdXBOZXdDYXJkLCB2YWxpZGF0aW9uRWxlbWVudHMsIGZvcm1BZGRDYXJkKTtcclxub3BlblByb2ZpbGVBdmF0YXJNb2RhbChwcm9maWxlSW1hZ2UsIHBvcHVwQXZhdGFyLCB2YWxpZGF0aW9uRWxlbWVudHMsIGF2YXRhckZvcm1FbGVtZW50KTtcclxuXHJcbnByb2ZpbGVGb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdCk7XHJcbmZvcm1BZGRDYXJkLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGhhbmRsZUZvcm1BZGRDYXJkU3VibWl0KTtcclxuYXZhdGFyRm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgaGFuZGxlQXZhdGFyRm9ybVN1Ym1pdCk7XHJcblxyXG5Qcm9taXNlLmFsbChbZ2V0VXNlckRhdGEoKSwgZ2V0Q2FyZHMoKV0pXHJcbiAgLnRoZW4oKFt1c2VyRGF0YSwgY2FyZHNdKSA9PiB7XHJcbiAgICBwcm9maWxlVGl0bGUudGV4dENvbnRlbnQgPSB1c2VyRGF0YS5uYW1lO1xyXG4gICAgcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50ID0gdXNlckRhdGEuYWJvdXQ7XHJcbiAgICBwcm9maWxlSW1hZ2Uuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gYHVybCgnJHt1c2VyRGF0YS5hdmF0YXJ9JylgXHJcbiAgICBjb25zdCBjdXJyZW50VXNlcklkID0gdXNlckRhdGEuX2lkO1xyXG4gICAgXHJcbiAgICBjYXJkcy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICBwbGFjZXNMaXN0LmFwcGVuZChjcmVhdGVDYXJkKGl0ZW0sIGhhbmRsZURlbGV0ZUNhcmQsIG9wZW5JbWFnZU1vZGFsLCBjdXJyZW50VXNlcklkLCBoYW5kbGVMaWtlQ2FyZCkpXHJcbiAgICB9KVxyXG4gIH0pXHJcbiAgLmNhdGNoKGVyciA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gIH0pXHJcblxyXG4gIGVuYWJsZVZhbGlkYXRpb24odmFsaWRhdGlvbkVsZW1lbnRzKTtcclxuXHJcbmZ1bmN0aW9uIG9wZW5BZGRDYXJkTW9kYWwgKGJ1dHRvbiwgbW9kYWwsIHZhbGlkYXRpb25FbGVtZW50cywgZm9ybUFkZENhcmQpIHtcclxuICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICBmb3JtQWRkQ2FyZC5yZXNldCgpO1xyXG4gICAgbW9kYWxPcGVuKG1vZGFsKTtcclxuICAgIGNsZWFyVmFsaWRhdGlvbihmb3JtQWRkQ2FyZCwgdmFsaWRhdGlvbkVsZW1lbnRzKTtcclxufSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG9wZW5Qcm9maWxlTW9kYWwgKGJ1dHRvbiwgbW9kYWwsIHZhbGlkYXRpb25FbGVtZW50cywgcHJvZmlsZUZvcm1FbGVtZW50KSB7XHJcbiAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgZmlsbE91dFRoZVByb2ZpbGVGb3JtKCk7XHJcbiAgICBtb2RhbE9wZW4obW9kYWwpO1xyXG4gICAgY2xlYXJWYWxpZGF0aW9uKHByb2ZpbGVGb3JtRWxlbWVudCwgdmFsaWRhdGlvbkVsZW1lbnRzKTtcclxuICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gb3BlblByb2ZpbGVBdmF0YXJNb2RhbCAoYnV0dG9uLCBtb2RhbCwgdmFsaWRhdGlvbkVsZW1lbnRzLCBhdmF0YXJGb3JtRWxlbWVudCkge1xyXG4gIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICAgIGF2YXRhckZvcm1FbGVtZW50LnJlc2V0KCk7XHJcbiAgICBtb2RhbE9wZW4obW9kYWwpO1xyXG4gICAgY2xlYXJWYWxpZGF0aW9uKGF2YXRhckZvcm1FbGVtZW50LCB2YWxpZGF0aW9uRWxlbWVudHMpO1xyXG4gIH0pXHJcbn1cclxuXHJcbmZ1bmN0aW9uIG9wZW5JbWFnZU1vZGFsIChpbWFnZSwgbW9kYWwsIHBvcHVwSW1hZ2UsIHBvcHVwQ2FwdGlvbikge1xyXG4gIHBvcHVwSW1hZ2Uuc3JjID0gaW1hZ2Uuc3JjO1xyXG4gIHBvcHVwSW1hZ2UuYWx0ID0gaW1hZ2UuYWx0O1xyXG4gIHBvcHVwQ2FwdGlvbi50ZXh0Q29udGVudCA9IGltYWdlLmFsdDtcclxuICBtb2RhbE9wZW4obW9kYWwpO1xyXG59XHJcblxyXG5wb3B1cHMuZm9yRWFjaCgobW9kYWwpID0+IHtcclxuICBtb2RhbC5jbGFzc0xpc3QuYWRkKCdwb3B1cF9pcy1hbmltYXRlZCcpO1xyXG4gIG1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2ZW50KSA9PiB7XHJcbiAgICBpZiAoZXZlbnQudGFyZ2V0ID09PSBldmVudC5jdXJyZW50VGFyZ2V0IHx8IGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3BvcHVwX19jbG9zZScpKSB7XHJcbiAgICAgIG1vZGFsQ2xvc2UobW9kYWwpO1xyXG4gICAgfVxyXG4gIH0pXHJcbn0pXHJcblxyXG5mdW5jdGlvbiBmaWxsT3V0VGhlUHJvZmlsZUZvcm0oKSB7XHJcbiAgbmFtZUlucHV0LnZhbHVlID0gcHJvZmlsZVRpdGxlLnRleHRDb250ZW50O1xyXG4gIGpvYklucHV0LnZhbHVlID0gcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50O1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdChldmVudCkge1xyXG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IFxyXG4gIHJlbmRlckxvYWRpbmcoZXZlbnQuc3VibWl0dGVyLCByZW5kZXJMb2FkaW5nU3RhdHVzLnNhdmluZyk7XHJcbiAgZWRpdFByb2ZpbGVJbmZvcm1hdGlvbihuYW1lSW5wdXQudmFsdWUsIGpvYklucHV0LnZhbHVlKVxyXG4gICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICBwcm9maWxlVGl0bGUudGV4dENvbnRlbnQgPSBuYW1lSW5wdXQudmFsdWU7XHJcbiAgICAgIHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IGpvYklucHV0LnZhbHVlO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgfSlcclxuICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgcmVuZGVyTG9hZGluZyhldmVudC5zdWJtaXR0ZXIsIHJlbmRlckxvYWRpbmdTdGF0dXMuc2F2ZSk7XHJcbiAgICAgIG1vZGFsQ2xvc2UocG9wdXBQcm9maWxlKTtcclxuICAgIH0pXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUZvcm1BZGRDYXJkU3VibWl0KGV2ZW50KSB7XHJcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICByZW5kZXJMb2FkaW5nKGV2ZW50LnN1Ym1pdHRlciwgcmVuZGVyTG9hZGluZ1N0YXR1cy5zYXZpbmcpO1xyXG4gIGNvbnN0IG5ld0NhcmQgPSB7XHJcbiAgICAgIG5hbWU6IHBsYWNlTmFtZWlucHV0LnZhbHVlLFxyXG4gICAgICBsaW5rOiBsaW5rSW5wdXQudmFsdWUsXHJcbiAgICB9XHJcbiAgICBzZW5kTmV3Q2FyZChuZXdDYXJkKVxyXG4gICAgLnRoZW4obmV3Q2FyZCA9PiB7XHJcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VySWQgPSBuZXdDYXJkLm93bmVyLl9pZDtcclxuICAgICAgcGxhY2VzTGlzdC5wcmVwZW5kKGNyZWF0ZUNhcmQobmV3Q2FyZCwgaGFuZGxlRGVsZXRlQ2FyZCwgb3BlbkltYWdlTW9kYWwsIGN1cnJlbnRVc2VySWQsIGhhbmRsZUxpa2VDYXJkKSk7XHJcbiAgICAgIGZvcm1BZGRDYXJkLnJlc2V0KCk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICB9KVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICByZW5kZXJMb2FkaW5nKGV2ZW50LnN1Ym1pdHRlciwgcmVuZGVyTG9hZGluZ1N0YXR1cy5zYXZlKTtcclxuICAgICAgbW9kYWxDbG9zZShwb3B1cE5ld0NhcmQpO1xyXG4gICAgfSlcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlQXZhdGFyRm9ybVN1Ym1pdChldmVudCkge1xyXG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgcmVuZGVyTG9hZGluZyhldmVudC5zdWJtaXR0ZXIsIHJlbmRlckxvYWRpbmdTdGF0dXMuc2F2aW5nKTtcclxuICBjb25zdCBhdmF0YXIgPSB7XHJcbiAgICBhdmF0YXI6IGxpbmtBdmF0YXJpbnB1dC52YWx1ZVxyXG4gIH1cclxuICB1cGRhdGVQcm9maWxlQXZhdGFyKGF2YXRhcilcclxuICAgIC50aGVuKGF2YXRhciA9PiB7XHJcbiAgICAgIHByb2ZpbGVJbWFnZS5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBgdXJsKCcke2F2YXRhci5hdmF0YXJ9JylgXHJcbiAgICAgIGF2YXRhckZvcm1FbGVtZW50LnJlc2V0KCk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICB9KVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICByZW5kZXJMb2FkaW5nKGV2ZW50LnN1Ym1pdHRlciwgcmVuZGVyTG9hZGluZ1N0YXR1cy5zYXZlKTtcclxuICAgICAgbW9kYWxDbG9zZShwb3B1cEF2YXRhcik7XHJcbiAgICB9KVxyXG59XHJcblxyXG5mdW5jdGlvbiByZW5kZXJMb2FkaW5nKGJ1dHRvbiwgc3RhdHVzKSB7XHJcbiAgICBidXR0b24udGV4dENvbnRlbnQgPSBzdGF0dXM7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUxpa2VDYXJkKHN0YXR1cywgY2FyZE51bWJlck9mTGlrZXMsIGNhcmRMaWtlQnV0dG9uLCBjYXJkSWQpIHtcclxuICBpZiAoIXN0YXR1cykge1xyXG4gICAgcHV0TGlrZUNhcmQoY2FyZElkKVxyXG4gICAgICAudGhlbihyZXMgPT4gY2hhbmdlTGlrZShyZXMsIGNhcmROdW1iZXJPZkxpa2VzLCBjYXJkTGlrZUJ1dHRvbikpXHJcbiAgICAgIC5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coZXJyKSlcclxuICB9XHJcbiAgZWxzZSB7XHJcbiAgICByZW1vdmVMaWtlKGNhcmRJZClcclxuICAgIC50aGVuKHJlcyA9PiBjaGFuZ2VMaWtlKHJlcywgY2FyZE51bWJlck9mTGlrZXMsIGNhcmRMaWtlQnV0dG9uKSlcclxuICAgIC5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coZXJyKSlcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZUNhcmQgKGNhcmQsIGNhcmRJZCkge1xyXG4gIGRlbGV0ZUNhcmRSZXF1ZXN0KGNhcmRJZClcclxuICAudGhlbigoKSA9PiBkZWxldGVDYXJkKGNhcmQpKVxyXG4gIC5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coZXJyKSlcclxufSJdLCJuYW1lcyI6WyJjYXJkVGVtcGxhdGUiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjb250ZW50IiwiY3JlYXRlQ2FyZCIsIml0ZW0iLCJoYW5kbGVEZWxldGVDYXJkIiwib3BlbkltYWdlTW9kYWwiLCJjdXJyZW50VXNlcklkIiwiaGFuZGxlTGlrZUNhcmQiLCJjYXJkRWxlbWVudCIsImNsb25lTm9kZSIsImNhcmRJbWFnZSIsImNhcmRUaXRsZSIsIm1vZGFsSW1hZ2UiLCJwb3B1cEltYWdlIiwicG9wdXBDYXB0aW9uIiwiY2FyZE51bWJlck9mTGlrZXMiLCJkZWxldGVCdXR0b24iLCJjYXJkTGlrZUJ1dHRvbiIsIm93bmVyIiwiX2lkIiwiaGlkZGVuIiwiY2FyZElkIiwic3JjIiwibGluayIsImFsdCIsIm5hbWUiLCJ0ZXh0Q29udGVudCIsImxpa2VzIiwibGVuZ3RoIiwic29tZSIsImxpa2UiLCJjbGFzc0xpc3QiLCJhZGQiLCJhZGRFdmVudExpc3RlbmVyIiwiY29udGFpbnMiLCJjaGVja1N0YXR1c0xpa2UiLCJjaGFuZ2VMaWtlIiwicmVzIiwidG9nZ2xlIiwibW9kYWxPcGVuIiwibW9kYWwiLCJtb2RhbENsb3NlRXNjIiwibW9kYWxDbG9zZSIsInJlbW92ZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJldmVudCIsImtleSIsInZhbGlkYXRpb25FbGVtZW50cyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiaGlkZUlucHV0RXJyb3IiLCJmb3JtRWxlbWVudCIsImlucHV0RWxlbWVudCIsImVycm9yRWxlbWVudCIsImNvbmNhdCIsImlkIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpc3QiLCJidXR0b25FbGVtZW50IiwidmFsaWRpdHkiLCJ2YWxpZCIsImhhc0ludmFsaWRJbnB1dCIsImRpc2FibGVkIiwiY2xlYXJWYWxpZGF0aW9uIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJjb25maWciLCJiYXNlVXJsIiwiaGVhZGVycyIsImF1dGhvcml6YXRpb24iLCJjaGVja1Jlc3BvbnNlIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsInBvcHVwcyIsInByb2ZpbGVGb3JtRWxlbWVudCIsImZvcm1zIiwibmFtZUlucHV0IiwiZWxlbWVudHMiLCJqb2JJbnB1dCIsImRlc2NyaXB0aW9uIiwicHJvZmlsZVRpdGxlIiwicHJvZmlsZURlc2NyaXB0aW9uIiwicHJvZmlsZUltYWdlIiwiZm9ybUFkZENhcmQiLCJsaW5rSW5wdXQiLCJwbGFjZU5hbWVpbnB1dCIsImF2YXRhckZvcm1FbGVtZW50IiwibGlua0F2YXRhcmlucHV0IiwiYXZhdGFyIiwicmVuZGVyTG9hZGluZ1N0YXR1cyIsInBsYWNlc0xpc3QiLCJwb3B1cFByb2ZpbGUiLCJwb3B1cE5ld0NhcmQiLCJwb3B1cEF2YXRhciIsInByb2ZpbGVFZGl0QnV0dG9uIiwicHJvZmlsZUFkZEJ1dHRvbiIsImltYWdlIiwicmVuZGVyTG9hZGluZyIsImJ1dHRvbiIsImZldGNoIiwibWV0aG9kIiwidGhlbiIsInJlbW92ZUxpa2UiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJwdXRMaWtlQ2FyZCIsImNhcmQiLCJkZWxldGVDYXJkUmVxdWVzdCIsImRlbGV0ZUNhcmQiLCJ2YWx1ZSIsIm9wZW5Qcm9maWxlTW9kYWwiLCJyZXNldCIsIm9wZW5BZGRDYXJkTW9kYWwiLCJvcGVuUHJvZmlsZUF2YXRhck1vZGFsIiwiYWJvdXQiLCJwcmV2ZW50RGVmYXVsdCIsInN1Ym1pdHRlciIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiZmluYWxseSIsIm5ld0NhcmQiLCJwcmVwZW5kIiwic3R5bGUiLCJiYWNrZ3JvdW5kSW1hZ2UiLCJhbGwiLCJfcmVmIiwiX3JlZjIiLCJ1c2VyRGF0YSIsImNhcmRzIiwiYXBwZW5kIiwicGF0dGVybk1pc21hdGNoIiwic2V0Q3VzdG9tVmFsaWRpdHkiLCJkYXRhc2V0IiwiZXJyb3JNZXNzYWdlIiwic2hvd0lucHV0RXJyb3IiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsImNoZWNrSW5wdXRWYWxpZGl0eSIsInNldEV2ZW50TGlzdGVuZXJzIiwiZW5hYmxlVmFsaWRhdGlvbiIsInRhcmdldCIsImN1cnJlbnRUYXJnZXQiXSwic291cmNlUm9vdCI6IiJ9