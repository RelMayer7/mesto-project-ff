(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{dm:()=>x,ob:()=>w,Dg:()=>P,eD:()=>A});var t={baseUrl:"https://nomoreparties.co/v1/wff-cohort-15",headers:{authorization:"a8cb1b2a-4431-497b-bdfb-7d64af336a26","Content-Type":"application/json"}},n=document.querySelector("#card-template").content;function r(e,t,r,o,c){var a=n.querySelector(".card").cloneNode(!0),i=a.querySelector(".card__image"),u=a.querySelector(".card__title"),s=document.querySelector(".popup_type_image"),l=a.querySelector(".card__number-of-likes"),d=a.querySelector(".card__delete-button"),f=a.querySelector(".card__like-button");c!==e.owner._id&&(d.hidden=!0),i.src=e.link,i.alt=e.name,u.textContent=e.name,l.textContent=e.likes.length;var p=e._id;return e.likes.some((function(e){return e._id===c}))&&f.classList.add("card__like-button_is-active"),f.addEventListener("click",(function(){return r(f,p,l)})),d.addEventListener("click",(function(){return t(a,p)})),i.addEventListener("click",(function(){return o(i,s)})),a}function o(e,n,r){e.classList.contains("card__like-button_is-active")?function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Не удалось удалить лайк карточки: ".concat(e.status))}))}(n).then((function(t){e.classList.remove("card__like-button_is-active"),r.textContent=t.likes.length})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Не удалось поставить лайк карточке: ".concat(e.status))}))}(n).then((function(t){e.classList.add("card__like-button_is-active"),r.textContent=t.likes.length})).catch((function(e){console.log(e)}))}function c(e,n){(function(e){return fetch("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Не удалось удалить карточку: ".concat(e.status))}))})(n).then((function(){e.remove()})).catch((function(e){console.log(e)}))}var a=document.querySelectorAll(".popup"),i=document.forms["edit-profile"],u=i.elements.name,s=i.elements.description,l=document.querySelector(".profile__title"),d=document.querySelector(".profile__description"),f=document.querySelector(".profile__image"),p=document.forms["new-place"],m=p.elements.link,v=p.elements["place-name"],h=document.forms["edit-avatar"],y=h.elements.avatar,_={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},b=function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""};function S(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))}function k(e,t){Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(n){b(e,n,t)})),function(e,t){e.disabled=!0,e.classList.add(t.inactiveButtonClass)}(e.querySelector(t.submitButtonSelector),t)}function g(e,t){t.querySelector(".popup__image").src=e.src,t.querySelector(".popup__caption").textContent=e.alt,E(t)}function E(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",L)}function C(e){e.classList.remove("popup_is-opened"),document.removeEventListener("click",L)}function L(e){var t=document.querySelector(".popup_is-opened");"Escape"===e.key&&C(t)}function q(e,t){e.textContent=t?"Сохранение...":"Сохранить"}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}a.forEach((function(e){e.classList.add("popup_is-animated"),e.addEventListener("click",(function(t){(t.target===t.currentTarget||t.target.classList.contains("popup__close"))&&C(e)}))}));var x=document.querySelector(".places__list"),A=document.querySelector(".popup_type_edit"),P=document.querySelector(".popup_type_new-card"),w=document.querySelector(".popup_type_avatar"),O=document.querySelector(".profile__edit-button"),T=document.querySelector(".profile__add-button");!function(e,t,n,r){e.addEventListener("click",(function(){u.value=l.textContent,s.value=d.textContent,E(t),k(r,n)}))}(O,A,_,i),function(e,t,n,r){e.addEventListener("click",(function(){r.reset(),E(t),k(r,n)}))}(T,P,_,p),function(e,t,n,r){e.addEventListener("click",(function(){r.reset(),E(t),k(r,n)}))}(f,w,_,h),i.addEventListener("submit",(function(e){var n,r;e.preventDefault(),q(e.submitter,!0),(n=u.value,r=s.value,fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:n,about:r})}).then((function(e){return e.ok?e.json():Promise.reject("Не удалось обновить информацию о профиле: ".concat(e.status))}))).then((function(){l.textContent=u.value,d.textContent=s.value})).catch((function(e){console.log(e),C(A)})).finally((function(){q(e.submitter,!1),C(A)}))})),p.addEventListener("submit",(function(e){var n;e.preventDefault(),q(e.submitter,!0),(n={name:v.value,link:m.value},fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify(n)}).then((function(e){return e.ok?e.json():Promise.reject("Не удалось отправить карточку: ".concat(e.status))}))).then((function(e){var t=e.owner._id;x.prepend(r(e,c,o,g,t)),p.reset()})).catch((function(e){console.log(e),p.reset(),C(P)})).finally((function(){q(e.submitter,!1),C(P)}))})),h.addEventListener("submit",(function(e){var n;e.preventDefault(),q(e.submitter,!0),(n={avatar:y.value},fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify(n)}).then((function(e){return e.ok?e.json():Promise.reject("Не удалось изменить аватар профиля: ".concat(e.status))}))).then((function(e){f.style.backgroundImage="url('".concat(e.avatar,"')"),h.reset()})).catch((function(e){console.log(e),C(w),h.reset()})).finally((function(){q(e.submitter,!1),C(w)}))})),Promise.all([fetch("".concat(t.baseUrl,"/users/me"),{method:"GET",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Не удалось получить информцию о профиле: ".concat(e.status))})),fetch("".concat(t.baseUrl,"/cards"),{method:"GET",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Не удалось загрузить карточки: ".concat(e.status))}))]).then((function(e){var t,n,a=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,a,i=[],u=!0,s=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){s=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw o}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return j(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?j(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=a[0],u=a[1];l.textContent=i.name,d.textContent=i.about,f.style.backgroundImage="url('".concat(i.avatar,"')");var s=i._id;u.forEach((function(e){x.append(r(e,c,o,g,s))}))})).catch((function(e){console.log(e)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);S(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?b(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(e,o,t),S(n,r,t)}))}))}(t,e)}))}(_)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkFDdkJ4RCxFQUFheUQsa0JBQWtCekQsRUFBYTBELFFBQVFDLGNBR3BEM0QsRUFBYXlELGtCQUFrQixJQUc3QnpELEVBQWFNLFNBQVNDLE1BSXhCVCxFQUFlQyxFQUFhQyxFQUFjVCxHQTFCOUMsU0FBeUJRLEVBQWFDLEVBQWMyRCxFQUFjcEUsR0FDaEUsSUFBTVUsRUFBZUYsRUFBWTdFLGNBQWMsSUFBRGtDLE9BQUs0QyxFQUFhRSxHQUFFLFdBQ2xFRixFQUFhakQsVUFBVUMsSUFBSXVDLEVBQW1CSyxpQkFDOUNLLEVBQWF4RCxZQUFja0gsRUFDM0IxRCxFQUFhbEQsVUFBVUMsSUFBSXVDLEVBQW1CTSxXQUNoRCxDQWtCSStELENBQWU3RCxFQUFhQyxFQUFjQSxFQUFhNkQsa0JBQW1CdEUsRUFLOUUsQ0FRTXVFLENBQW1CL0QsRUFBYUMsRUFBY1QsR0FDOUNZLEVBQWtCQyxFQUFXQyxFQUFlZCxFQUM5QyxHQUNGLEdBQ0YsQ0FzQkl3RSxDQUFrQmhFLEVBQWFSLEVBQ2pDLEdBQ0YsQ0UvQkV5RSxDQUFpQnpFLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tZXN0by1wcm9qZWN0LWZmL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL21lc3RvLXByb2plY3QtZmYvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL21lc3RvLXByb2plY3QtZmYvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9tZXN0by1wcm9qZWN0LWZmLy4vc3JjL2NvbXBvbmVudHMvYXBpLmpzIiwid2VicGFjazovL21lc3RvLXByb2plY3QtZmYvLi9zcmMvY29tcG9uZW50cy9jYXJkLmpzIiwid2VicGFjazovL21lc3RvLXByb2plY3QtZmYvLi9zcmMvY29tcG9uZW50cy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vbWVzdG8tcHJvamVjdC1mZi8uL3NyYy9jb21wb25lbnRzL3ZhbGlkYXRpb24uanMiLCJ3ZWJwYWNrOi8vbWVzdG8tcHJvamVjdC1mZi8uL3NyYy9jb21wb25lbnRzL21vZGFsLmpzIiwid2VicGFjazovL21lc3RvLXByb2plY3QtZmYvLi9zcmMvc2NyaXB0cy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUaGUgcmVxdWlyZSBzY29wZVxudmFyIF9fd2VicGFja19yZXF1aXJlX18gPSB7fTtcblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vINCi0L7QutC10L06IGE4Y2IxYjJhLTQ0MzEtNDk3Yi1iZGZiLTdkNjRhZjMzNmEyNlxyXG4vLyDQmNC00LXQvdGC0LjRhNC40LrQsNGC0L7RgCDQs9GA0YPQv9C/0Ys6IHdmZi1jb2hvcnQtMTVcclxuXHJcbmNvbnN0IGNvbmZpZyA9IHtcclxuICBiYXNlVXJsOiAnaHR0cHM6Ly9ub21vcmVwYXJ0aWVzLmNvL3YxL3dmZi1jb2hvcnQtMTUnLFxyXG4gIGhlYWRlcnM6IHtcclxuICAgIGF1dGhvcml6YXRpb246ICdhOGNiMWIyYS00NDMxLTQ5N2ItYmRmYi03ZDY0YWYzMzZhMjYnLFxyXG4gICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFVzZXJEYXRhKCl7XHJcbiAgcmV0dXJuIGZldGNoKGAke2NvbmZpZy5iYXNlVXJsfS91c2Vycy9tZWAsIHtcclxuICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVycyxcclxuICB9KVxyXG4gIC50aGVuKHJlcyA9PiB7XHJcbiAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGDQndC1INGD0LTQsNC70L7RgdGMINC/0L7Qu9GD0YfQuNGC0Ywg0LjQvdGE0L7RgNC80YbQuNGOINC+INC/0YDQvtGE0LjQu9C1OiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgfSlcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldENhcmRzKCkge1xyXG4gIHJldHVybiBmZXRjaChgJHtjb25maWcuYmFzZVVybH0vY2FyZHNgLCB7XHJcbiAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgfSlcclxuICAudGhlbihyZXMgPT4ge1xyXG4gICAgaWYgKHJlcy5vaykge1xyXG4gICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgIH1cclxuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChg0J3QtSDRg9C00LDQu9C+0YHRjCDQt9Cw0LPRgNGD0LfQuNGC0Ywg0LrQsNGA0YLQvtGH0LrQuDogJHtyZXMuc3RhdHVzfWApO1xyXG4gIH0pXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBlZGl0UHJvZmlsZUluZm9ybWF0aW9uKG5hbWUsIGFib3V0KSB7XHJcbiAgcmV0dXJuIGZldGNoKGAke2NvbmZpZy5iYXNlVXJsfS91c2Vycy9tZWAsIHtcclxuICAgIG1ldGhvZDogJ1BBVENIJyxcclxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzLFxyXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe25hbWUsIGFib3V0fSlcclxuICB9KVxyXG4gIC50aGVuKHJlcyA9PiB7XHJcbiAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGDQndC1INGD0LTQsNC70L7RgdGMINC+0LHQvdC+0LLQuNGC0Ywg0LjQvdGE0L7RgNC80LDRhtC40Y4g0L4g0L/RgNC+0YTQuNC70LU6ICR7cmVzLnN0YXR1c31gKTtcclxuICB9KVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2VuZE5ld0NhcmQobmV3Q2FyZCkge1xyXG4gIHJldHVybiBmZXRjaChgJHtjb25maWcuYmFzZVVybH0vY2FyZHNgLHtcclxuICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeShuZXdDYXJkKSxcclxuICB9KVxyXG4gIC50aGVuKHJlcyA9PiB7XHJcbiAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGDQndC1INGD0LTQsNC70L7RgdGMINC+0YLQv9GA0LDQstC40YLRjCDQutCw0YDRgtC+0YfQutGDOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgfSlcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGRlbGV0ZUNhcmRSZXF1ZXN0KGNhcmRJZCl7XHJcbiAgcmV0dXJuIGZldGNoKGAke2NvbmZpZy5iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH1gLHtcclxuICAgIG1ldGhvZDogJ0RFTEVURScsXHJcbiAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVycyxcclxuICB9KVxyXG4gIC50aGVuKHJlcyA9PiB7XHJcbiAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGDQndC1INGD0LTQsNC70L7RgdGMINGD0LTQsNC70LjRgtGMINC60LDRgNGC0L7Rh9C60YM6ICR7cmVzLnN0YXR1c31gKTtcclxuICB9KVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gYWRkTGlrZShjYXJkSWQpe1xyXG4gIHJldHVybiBmZXRjaChgJHtjb25maWcuYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCx7XHJcbiAgICBtZXRob2Q6ICdQVVQnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgfSlcclxuICAudGhlbihyZXMgPT4ge1xyXG4gICAgaWYgKHJlcy5vaykge1xyXG4gICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgIH1cclxuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChg0J3QtSDRg9C00LDQu9C+0YHRjCDQv9C+0YHRgtCw0LLQuNGC0Ywg0LvQsNC50Log0LrQsNGA0YLQvtGH0LrQtTogJHtyZXMuc3RhdHVzfWApO1xyXG4gIH0pXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiByZW1vdmVMaWtlKGNhcmRJZCl7XHJcbnJldHVybiBmZXRjaChgJHtjb25maWcuYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCx7XHJcbiAgbWV0aG9kOiAnREVMRVRFJyxcclxuICBoZWFkZXJzOiBjb25maWcuaGVhZGVycyxcclxufSlcclxuLnRoZW4ocmVzID0+IHtcclxuICBpZiAocmVzLm9rKSB7XHJcbiAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICB9XHJcbiAgcmV0dXJuIFByb21pc2UucmVqZWN0KGDQndC1INGD0LTQsNC70L7RgdGMINGD0LTQsNC70LjRgtGMINC70LDQudC6INC60LDRgNGC0L7Rh9C60Lg6ICR7cmVzLnN0YXR1c31gKTtcclxufSlcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVByb2ZpbGVBdmF0YXIoYXZhdGFyKXtcclxuICByZXR1cm4gZmV0Y2goYCR7Y29uZmlnLmJhc2VVcmx9L3VzZXJzL21lL2F2YXRhcmAsIHtcclxuICAgIG1ldGhvZDogJ1BBVENIJyxcclxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzLFxyXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoYXZhdGFyKSxcclxuICB9KVxyXG4gIC50aGVuKHJlcyA9PiB7XHJcbiAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGDQndC1INGD0LTQsNC70L7RgdGMINC40LfQvNC10L3QuNGC0Ywg0LDQstCw0YLQsNGAINC/0YDQvtGE0LjQu9GPOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgfSlcclxufSIsImltcG9ydCB7IGRlbGV0ZUNhcmRSZXF1ZXN0LCByZW1vdmVMaWtlLCBhZGRMaWtlIH0gZnJvbSBcIi4vYXBpLmpzXCI7XHJcblxyXG5jb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjY2FyZC10ZW1wbGF0ZScpLmNvbnRlbnQ7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQ2FyZCAoaXRlbSwgZGVsZXRlQ2FyZCwgbGlrZUNhcmQsIG9wZW5JbWFnZU1vZGFsLCBjdXJyZW50VXNlcklkKSB7XHJcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkVGVtcGxhdGUucXVlcnlTZWxlY3RvcignLmNhcmQnKS5jbG9uZU5vZGUodHJ1ZSk7XHJcblxyXG4gIGNvbnN0IGNhcmRJbWFnZSA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19pbWFnZScpO1xyXG4gIGNvbnN0IGNhcmRUaXRsZSA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX190aXRsZScpO1xyXG4gIGNvbnN0IG1vZGFsSW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfdHlwZV9pbWFnZScpO1xyXG4gIGNvbnN0IGNhcmROdW1iZXJPZkxpa2VzID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcignLmNhcmRfX251bWJlci1vZi1saWtlcycpO1xyXG4gIGNvbnN0IGRlbGV0ZUJ1dHRvbiA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19kZWxldGUtYnV0dG9uJyk7XHJcbiAgY29uc3QgY2FyZExpa2VCdXR0b24gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1idXR0b24nKTtcclxuXHJcbiAgaWYgKGN1cnJlbnRVc2VySWQgIT09IGl0ZW0ub3duZXIuX2lkKXtcclxuICAgIGRlbGV0ZUJ1dHRvbi5oaWRkZW4gPSB0cnVlO1xyXG4gIH1cclxuXHJcbiAgY2FyZEltYWdlLnNyYyA9IGl0ZW0ubGluaztcclxuICBjYXJkSW1hZ2UuYWx0ID0gaXRlbS5uYW1lO1xyXG4gIGNhcmRUaXRsZS50ZXh0Q29udGVudCA9IGl0ZW0ubmFtZTtcclxuICBjYXJkTnVtYmVyT2ZMaWtlcy50ZXh0Q29udGVudCA9IGl0ZW0ubGlrZXMubGVuZ3RoO1xyXG4gIGNvbnN0IGNhcmRJZCA9IGl0ZW0uX2lkO1xyXG5cclxuICBjb25zdCBsaWtlSXQgPSBpdGVtLmxpa2VzLnNvbWUobGlrZSA9PiBsaWtlLl9pZCA9PT0gY3VycmVudFVzZXJJZCk7XHJcbiAgaWYgKGxpa2VJdCkge1xyXG4gICAgY2FyZExpa2VCdXR0b24uY2xhc3NMaXN0LmFkZCgnY2FyZF9fbGlrZS1idXR0b25faXMtYWN0aXZlJyk7XHJcbiAgfVxyXG5cclxuICBjYXJkTGlrZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IGxpa2VDYXJkKGNhcmRMaWtlQnV0dG9uLCBjYXJkSWQsIGNhcmROdW1iZXJPZkxpa2VzKSk7XHJcbiAgZGVsZXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gZGVsZXRlQ2FyZChjYXJkRWxlbWVudCwgY2FyZElkKSk7XHJcbiAgY2FyZEltYWdlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gb3BlbkltYWdlTW9kYWwoY2FyZEltYWdlLCBtb2RhbEltYWdlKSk7XHJcblxyXG4gIHJldHVybiBjYXJkRWxlbWVudDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGxpa2VDYXJkKGNhcmRMaWtlQnV0dG9uLCBjYXJkSWQsIGNhcmROdW1iZXJPZkxpa2VzKXtcclxuICBjb25zdCBsaWtlSXQgPSBjYXJkTGlrZUJ1dHRvbi5jbGFzc0xpc3QuY29udGFpbnMoJ2NhcmRfX2xpa2UtYnV0dG9uX2lzLWFjdGl2ZScpO1xyXG5cclxuICBpZiAobGlrZUl0KSB7XHJcbiAgICByZW1vdmVMaWtlKGNhcmRJZClcclxuICAgICAgLnRoZW4ocmVzID0+e1xyXG4gICAgICAgIGNhcmRMaWtlQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoJ2NhcmRfX2xpa2UtYnV0dG9uX2lzLWFjdGl2ZScpO1xyXG4gICAgICAgIGNhcmROdW1iZXJPZkxpa2VzLnRleHRDb250ZW50ID0gcmVzLmxpa2VzLmxlbmd0aDtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coZXJyKTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG4gIGVsc2Uge1xyXG4gICAgYWRkTGlrZShjYXJkSWQpXHJcbiAgICAgIC50aGVuKHJlcyA9PiB7XHJcbiAgICAgICAgY2FyZExpa2VCdXR0b24uY2xhc3NMaXN0LmFkZCgnY2FyZF9fbGlrZS1idXR0b25faXMtYWN0aXZlJyk7XHJcbiAgICAgICAgY2FyZE51bWJlck9mTGlrZXMudGV4dENvbnRlbnQgPSByZXMubGlrZXMubGVuZ3RoO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBkZWxldGVDYXJkIChjYXJkLCBjYXJkSWQpIHtcclxuICBkZWxldGVDYXJkUmVxdWVzdChjYXJkSWQpXHJcbiAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgIGNhcmQucmVtb3ZlKClcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgY29uc29sZS5sb2coZXJyKTtcclxuICAgIH0pO1xyXG59IiwiZXhwb3J0IHtwcm9maWxlRm9ybUVsZW1lbnQsIG5hbWVJbnB1dCwgam9iSW5wdXQsXHJcbiAgICAgICAgcHJvZmlsZVRpdGxlLCBwcm9maWxlRGVzY3JpcHRpb24sIHByb2ZpbGVJbWFnZSxcclxuICAgICAgICBhZGRDYXJkRm9ybUVsZW1lbnQsIGxpbmtJbnB1dCwgcGxhY2VOYW1laW5wdXQsXHJcbiAgICAgICAgcG9wdXBzLCBhdmF0YXJGb3JtRWxlbWVudCwgbGlua0F2YXRhcmlucHV0fVxyXG5cclxuY29uc3QgcG9wdXBzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBvcHVwJyk7XHJcblxyXG5jb25zdCBwcm9maWxlRm9ybUVsZW1lbnQgPSBkb2N1bWVudC5mb3Jtc1snZWRpdC1wcm9maWxlJ107XHJcbmNvbnN0IG5hbWVJbnB1dCA9IHByb2ZpbGVGb3JtRWxlbWVudC5lbGVtZW50cy5uYW1lO1xyXG5jb25zdCBqb2JJbnB1dCA9IHByb2ZpbGVGb3JtRWxlbWVudC5lbGVtZW50cy5kZXNjcmlwdGlvbjtcclxuY29uc3QgcHJvZmlsZVRpdGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX3RpdGxlJyk7XHJcbmNvbnN0IHByb2ZpbGVEZXNjcmlwdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19kZXNjcmlwdGlvbicpO1xyXG5jb25zdCBwcm9maWxlSW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9faW1hZ2UnKTtcclxuXHJcbmNvbnN0IGFkZENhcmRGb3JtRWxlbWVudCA9IGRvY3VtZW50LmZvcm1zWyduZXctcGxhY2UnXTtcclxuY29uc3QgbGlua0lucHV0ID0gYWRkQ2FyZEZvcm1FbGVtZW50LmVsZW1lbnRzLmxpbms7XHJcbmNvbnN0IHBsYWNlTmFtZWlucHV0ID0gYWRkQ2FyZEZvcm1FbGVtZW50LmVsZW1lbnRzWydwbGFjZS1uYW1lJ107XHJcblxyXG5jb25zdCBhdmF0YXJGb3JtRWxlbWVudCA9IGRvY3VtZW50LmZvcm1zWydlZGl0LWF2YXRhciddO1xyXG5jb25zdCBsaW5rQXZhdGFyaW5wdXQgPSBhdmF0YXJGb3JtRWxlbWVudC5lbGVtZW50cy5hdmF0YXI7IiwiZXhwb3J0IGNvbnN0IHZhbGlkYXRpb25FbGVtZW50cyA9IHtcclxuICBmb3JtU2VsZWN0b3I6ICcucG9wdXBfX2Zvcm0nLFxyXG4gIGlucHV0U2VsZWN0b3I6ICcucG9wdXBfX2lucHV0JyxcclxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogJy5wb3B1cF9fYnV0dG9uJyxcclxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiAncG9wdXBfX2J1dHRvbl9kaXNhYmxlZCcsXHJcbiAgaW5wdXRFcnJvckNsYXNzOiAncG9wdXBfX2lucHV0X3R5cGVfZXJyb3InLFxyXG4gIGVycm9yQ2xhc3M6ICdwb3B1cF9fZXJyb3JfdmlzaWJsZSdcclxufTtcclxuXHJcbmZ1bmN0aW9uIHNob3dJbnB1dEVycm9yIChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBlcnJvck1lc3NhZ2UsIHZhbGlkYXRpb25FbGVtZW50cykge1xyXG4gIGNvbnN0IGVycm9yRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcclxuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh2YWxpZGF0aW9uRWxlbWVudHMuaW5wdXRFcnJvckNsYXNzKTtcclxuICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XHJcbiAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQodmFsaWRhdGlvbkVsZW1lbnRzLmVycm9yQ2xhc3MpO1xyXG59XHJcblxyXG5jb25zdCBoaWRlSW5wdXRFcnJvciA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCB2YWxpZGF0aW9uRWxlbWVudHMpID0+IHtcclxuICBjb25zdCBlcnJvckVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCk7XHJcbiAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodmFsaWRhdGlvbkVsZW1lbnRzLmlucHV0RXJyb3JDbGFzcyk7XHJcbiAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodmFsaWRhdGlvbkVsZW1lbnRzLmVycm9yQ2xhc3MpO1xyXG4gIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9ICcnO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gY2hlY2tJbnB1dFZhbGlkaXR5IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCB2YWxpZGF0aW9uRWxlbWVudHMpIHtcclxuICBpZihpbnB1dEVsZW1lbnQudmFsaWRpdHkucGF0dGVybk1pc21hdGNoKSB7XHJcbiAgICBpbnB1dEVsZW1lbnQuc2V0Q3VzdG9tVmFsaWRpdHkoaW5wdXRFbGVtZW50LmRhdGFzZXQuZXJyb3JNZXNzYWdlKTtcclxuICB9IFxyXG4gIGVsc2Uge1xyXG4gICAgaW5wdXRFbGVtZW50LnNldEN1c3RvbVZhbGlkaXR5KFwiXCIpO1xyXG4gIH1cclxuXHJcbiAgaWYoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkgIHtcclxuICAgIHNob3dJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSwgdmFsaWRhdGlvbkVsZW1lbnRzKTtcclxuICB9XHJcbiAgZWxzZSB7XHJcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCB2YWxpZGF0aW9uRWxlbWVudHMpO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gc2V0RXZlbnRMaXN0ZW5lcnMgKGZvcm1FbGVtZW50LCB2YWxpZGF0aW9uRWxlbWVudHMpIHtcclxuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodmFsaWRhdGlvbkVsZW1lbnRzLmlucHV0U2VsZWN0b3IpKTtcclxuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3Rvcih2YWxpZGF0aW9uRWxlbWVudHMuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xyXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgdmFsaWRhdGlvbkVsZW1lbnRzKTtcclxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGNoZWNrSW5wdXRWYWxpZGl0eShmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCB2YWxpZGF0aW9uRWxlbWVudHMpO1xyXG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIHZhbGlkYXRpb25FbGVtZW50cyk7XHJcbiAgICB9KVxyXG4gIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSB7XHJcbiAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgIHJldHVybiAhaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkO1xyXG4gIH0pXHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgdmFsaWRhdGlvbkVsZW1lbnRzKSB7XHJcbiAgaWYgKGhhc0ludmFsaWRJbnB1dChpbnB1dExpc3QpKSB7XHJcbiAgICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKHZhbGlkYXRpb25FbGVtZW50cy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICB9XHJcbiAgZWxzZSB7XHJcbiAgICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodmFsaWRhdGlvbkVsZW1lbnRzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGVuYWJsZVZhbGlkYXRpb24odmFsaWRhdGlvbkVsZW1lbnRzKSB7XHJcbiAgY29uc3QgZm9ybUxpc3QgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodmFsaWRhdGlvbkVsZW1lbnRzLmZvcm1TZWxlY3RvcikpO1xyXG4gIGZvcm1MaXN0LmZvckVhY2goZm9ybUVsZW1lbnQgPT4ge1xyXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsZW1lbnQsIHZhbGlkYXRpb25FbGVtZW50cyk7XHJcbiAgfSlcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjbGVhclZhbGlkYXRpb24oZm9ybUVsZW1lbnQsIHZhbGlkYXRpb25FbGVtZW50cykge1xyXG4gIGNvbnN0IGlucHV0bGlzdCA9IEFycmF5LmZyb20oZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCh2YWxpZGF0aW9uRWxlbWVudHMuaW5wdXRTZWxlY3RvcikpO1xyXG4gIGlucHV0bGlzdC5mb3JFYWNoKGlucHV0RWxlbWVudCA9PiB7XHJcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCB2YWxpZGF0aW9uRWxlbWVudHMpXHJcbiAgfSlcclxuXHJcbiAgY29uc3QgYnV0dG9uRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IodmFsaWRhdGlvbkVsZW1lbnRzLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcclxuICBidXR0b25JbmFjdGl2ZShidXR0b25FbGVtZW50LCB2YWxpZGF0aW9uRWxlbWVudHMpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBidXR0b25JbmFjdGl2ZShidXR0b25FbGVtZW50LCB2YWxpZGF0aW9uRWxlbWVudHMpIHtcclxuICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcclxuICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQodmFsaWRhdGlvbkVsZW1lbnRzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG59IiwiaW1wb3J0IHtwbGFjZXNMaXN0LCBwb3B1cFByb2ZpbGUsIHBvcHVwTmV3Q2FyZCwgcG9wdXBBdmF0YXJ9IGZyb20gJy4uL3NjcmlwdHMvaW5kZXguanMnO1xyXG5pbXBvcnQge2NyZWF0ZUNhcmQsIGRlbGV0ZUNhcmQsIGxpa2VDYXJkfSBmcm9tICcuL2NhcmQuanMnO1xyXG5pbXBvcnQge3BvcHVwcywgbmFtZUlucHV0LCBqb2JJbnB1dCwgcHJvZmlsZVRpdGxlLCBwcm9maWxlRGVzY3JpcHRpb24sIGxpbmtJbnB1dCwgcGxhY2VOYW1laW5wdXQsIGFkZENhcmRGb3JtRWxlbWVudCwgbGlua0F2YXRhcmlucHV0LCBhdmF0YXJGb3JtRWxlbWVudCwgcHJvZmlsZUltYWdlfSBmcm9tICcuL2NvbnN0YW50cy5qcyc7XHJcbmltcG9ydCB7ZWRpdFByb2ZpbGVJbmZvcm1hdGlvbiwgc2VuZE5ld0NhcmQsIHVwZGF0ZVByb2ZpbGVBdmF0YXJ9IGZyb20gJy4vYXBpLmpzJztcclxuaW1wb3J0IHtjbGVhclZhbGlkYXRpb259IGZyb20gJy4vdmFsaWRhdGlvbi5qcyc7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gb3BlbkFkZENhcmRNb2RhbCAoYnV0dG9uLCBtb2RhbCwgdmFsaWRhdGlvbkVsZW1lbnRzLCBhZGRDYXJkRm9ybUVsZW1lbnQpIHtcclxuICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICBhZGRDYXJkRm9ybUVsZW1lbnQucmVzZXQoKTtcclxuICAgIG1vZGFsT3Blbihtb2RhbCk7XHJcbiAgICBjbGVhclZhbGlkYXRpb24oYWRkQ2FyZEZvcm1FbGVtZW50LCB2YWxpZGF0aW9uRWxlbWVudHMpO1xyXG59KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG9wZW5Qcm9maWxlTW9kYWwgKGJ1dHRvbiwgbW9kYWwsIHZhbGlkYXRpb25FbGVtZW50cywgcHJvZmlsZUZvcm1FbGVtZW50KSB7XHJcbiAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgZmlsbE91dFRoZVByb2ZpbGVGb3JtKCk7XHJcbiAgICBtb2RhbE9wZW4obW9kYWwpO1xyXG4gICAgY2xlYXJWYWxpZGF0aW9uKHByb2ZpbGVGb3JtRWxlbWVudCwgdmFsaWRhdGlvbkVsZW1lbnRzKTtcclxuICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG9wZW5Qcm9maWxlQXZhdGFyTW9kYWwgKGJ1dHRvbiwgbW9kYWwsIHZhbGlkYXRpb25FbGVtZW50cywgYXZhdGFyRm9ybUVsZW1lbnQpIHtcclxuICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICBhdmF0YXJGb3JtRWxlbWVudC5yZXNldCgpO1xyXG4gICAgbW9kYWxPcGVuKG1vZGFsKTtcclxuICAgIGNsZWFyVmFsaWRhdGlvbihhdmF0YXJGb3JtRWxlbWVudCwgdmFsaWRhdGlvbkVsZW1lbnRzKTtcclxuICB9KVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gb3BlbkltYWdlTW9kYWwgKGltYWdlLCBtb2RhbCkge1xyXG4gIG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9faW1hZ2UnKS5zcmMgPSBpbWFnZS5zcmM7XHJcbiAgbW9kYWwucXVlcnlTZWxlY3RvcignLnBvcHVwX19jYXB0aW9uJykudGV4dENvbnRlbnQgPSBpbWFnZS5hbHQ7XHJcbiAgbW9kYWxPcGVuKG1vZGFsKTtcclxufVxyXG5cclxucG9wdXBzLmZvckVhY2goKG1vZGFsKSA9PiB7XHJcbiAgbW9kYWwuY2xhc3NMaXN0LmFkZCgncG9wdXBfaXMtYW5pbWF0ZWQnKTtcclxuXHJcbiAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZlbnQpID0+IHtcclxuICAgIGlmIChldmVudC50YXJnZXQgPT09IGV2ZW50LmN1cnJlbnRUYXJnZXQgfHwgZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygncG9wdXBfX2Nsb3NlJykpIHtcclxuICAgICAgbW9kYWxDbG9zZShtb2RhbCk7XHJcbiAgICB9XHJcbiAgfSlcclxufSlcclxuXHJcbmZ1bmN0aW9uIG1vZGFsT3Blbihtb2RhbCkge1xyXG4gIG1vZGFsLmNsYXNzTGlzdC5hZGQoJ3BvcHVwX2lzLW9wZW5lZCcpO1xyXG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBtb2RhbENsb3NlRXNjKTtcclxufVxyXG5cclxuZnVuY3Rpb24gbW9kYWxDbG9zZShtb2RhbCkge1xyXG4gIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ3BvcHVwX2lzLW9wZW5lZCcpO1xyXG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgbW9kYWxDbG9zZUVzYyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG1vZGFsQ2xvc2VFc2MgKGV2ZW50KSB7XHJcbiAgY29uc3Qgb3BlbmVkUG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfaXMtb3BlbmVkJyk7XHJcbiAgaWYgKGV2ZW50LmtleSA9PT0gJ0VzY2FwZScpIHtcclxuICAgIG1vZGFsQ2xvc2Uob3BlbmVkUG9wdXApO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gZmlsbE91dFRoZVByb2ZpbGVGb3JtKCkge1xyXG4gIG5hbWVJbnB1dC52YWx1ZSA9IHByb2ZpbGVUaXRsZS50ZXh0Q29udGVudDtcclxuICBqb2JJbnB1dC52YWx1ZSA9IHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0KGV2ZW50KSB7XHJcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTsgXHJcbiAgcmVuZGVyTG9hZGluZyhldmVudC5zdWJtaXR0ZXIsIHRydWUpO1xyXG4gIGVkaXRQcm9maWxlSW5mb3JtYXRpb24obmFtZUlucHV0LnZhbHVlLCBqb2JJbnB1dC52YWx1ZSlcclxuICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgcHJvZmlsZVRpdGxlLnRleHRDb250ZW50ID0gbmFtZUlucHV0LnZhbHVlO1xyXG4gICAgICBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSBqb2JJbnB1dC52YWx1ZTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgY29uc29sZS5sb2coZXJyKTtcclxuICAgICAgbW9kYWxDbG9zZShwb3B1cFByb2ZpbGUpO1xyXG4gICAgfSlcclxuICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgcmVuZGVyTG9hZGluZyhldmVudC5zdWJtaXR0ZXIsIGZhbHNlKTtcclxuICAgICAgbW9kYWxDbG9zZShwb3B1cFByb2ZpbGUpO1xyXG4gICAgfSlcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZUZvcm1BZGRDYXJkU3VibWl0KGV2ZW50KSB7XHJcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICByZW5kZXJMb2FkaW5nKGV2ZW50LnN1Ym1pdHRlciwgdHJ1ZSk7XHJcbiAgY29uc3QgbmV3Q2FyZCA9IHtcclxuICAgICAgbmFtZTogcGxhY2VOYW1laW5wdXQudmFsdWUsXHJcbiAgICAgIGxpbms6IGxpbmtJbnB1dC52YWx1ZSxcclxuICAgIH1cclxuICAgIHNlbmROZXdDYXJkKG5ld0NhcmQpXHJcbiAgICAudGhlbihuZXdDYXJkID0+IHtcclxuICAgICAgY29uc3QgY3VycmVudFVzZXJJZCA9IG5ld0NhcmQub3duZXIuX2lkO1xyXG4gICAgICBwbGFjZXNMaXN0LnByZXBlbmQoY3JlYXRlQ2FyZChuZXdDYXJkLCBkZWxldGVDYXJkLCBsaWtlQ2FyZCwgb3BlbkltYWdlTW9kYWwsIGN1cnJlbnRVc2VySWQpKTtcclxuICAgICAgYWRkQ2FyZEZvcm1FbGVtZW50LnJlc2V0KCk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICAgIGFkZENhcmRGb3JtRWxlbWVudC5yZXNldCgpO1xyXG4gICAgICBtb2RhbENsb3NlKHBvcHVwTmV3Q2FyZCk7XHJcbiAgICB9KVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICByZW5kZXJMb2FkaW5nKGV2ZW50LnN1Ym1pdHRlciwgZmFsc2UpO1xyXG4gICAgICBtb2RhbENsb3NlKHBvcHVwTmV3Q2FyZCk7XHJcbiAgICB9KVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlQXZhdGFyRm9ybVN1Ym1pdChldmVudCkge1xyXG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgcmVuZGVyTG9hZGluZyhldmVudC5zdWJtaXR0ZXIsIHRydWUpO1xyXG4gIGNvbnN0IGF2YXRhciA9IHtcclxuICAgIGF2YXRhcjogbGlua0F2YXRhcmlucHV0LnZhbHVlXHJcbiAgfVxyXG4gIHVwZGF0ZVByb2ZpbGVBdmF0YXIoYXZhdGFyKVxyXG4gICAgLnRoZW4oYXZhdGFyID0+IHtcclxuICAgICAgcHJvZmlsZUltYWdlLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IGB1cmwoJyR7YXZhdGFyLmF2YXRhcn0nKWBcclxuICAgICAgYXZhdGFyRm9ybUVsZW1lbnQucmVzZXQoKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgY29uc29sZS5sb2coZXJyKTtcclxuICAgICAgbW9kYWxDbG9zZShwb3B1cEF2YXRhcik7XHJcbiAgICAgIGF2YXRhckZvcm1FbGVtZW50LnJlc2V0KCk7XHJcbiAgICB9KVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICByZW5kZXJMb2FkaW5nKGV2ZW50LnN1Ym1pdHRlciwgZmFsc2UpO1xyXG4gICAgICBtb2RhbENsb3NlKHBvcHVwQXZhdGFyKTtcclxuICAgIH0pXHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJlbmRlckxvYWRpbmcoYnV0dG9uLCBpc0xvYWRpbmcpIHtcclxuICBpZiAoaXNMb2FkaW5nKSB7XHJcbiAgICBidXR0b24udGV4dENvbnRlbnQgPSAn0KHQvtGF0YDQsNC90LXQvdC40LUuLi4nO1xyXG4gIH1cclxuICBlbHNlIHtcclxuICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9ICfQodC+0YXRgNCw0L3QuNGC0YwnO1xyXG4gIH1cclxufSIsImltcG9ydCAnLi4vcGFnZXMvaW5kZXguY3NzJztcclxuaW1wb3J0IHtjcmVhdGVDYXJkLCBkZWxldGVDYXJkLCBsaWtlQ2FyZH0gZnJvbSAnLi4vY29tcG9uZW50cy9jYXJkLmpzJztcclxuaW1wb3J0IHtvcGVuUHJvZmlsZU1vZGFsLCBvcGVuQWRkQ2FyZE1vZGFsLCBvcGVuSW1hZ2VNb2RhbCwgaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQsIGhhbmRsZUZvcm1BZGRDYXJkU3VibWl0LCBvcGVuUHJvZmlsZUF2YXRhck1vZGFsLCBoYW5kbGVBdmF0YXJGb3JtU3VibWl0fSBmcm9tICcuLi9jb21wb25lbnRzL21vZGFsLmpzJztcclxuaW1wb3J0IHtwcm9maWxlRm9ybUVsZW1lbnQsIGFkZENhcmRGb3JtRWxlbWVudCwgYXZhdGFyRm9ybUVsZW1lbnQsIHByb2ZpbGVUaXRsZSwgcHJvZmlsZURlc2NyaXB0aW9uLCBwcm9maWxlSW1hZ2V9IGZyb20gJy4uL2NvbXBvbmVudHMvY29uc3RhbnRzLmpzJztcclxuaW1wb3J0IHtlbmFibGVWYWxpZGF0aW9uLCB2YWxpZGF0aW9uRWxlbWVudHN9IGZyb20gJy4uL2NvbXBvbmVudHMvdmFsaWRhdGlvbi5qcyc7XHJcbmltcG9ydCB7Z2V0VXNlckRhdGEsIGdldENhcmRzfSBmcm9tICcuLi9jb21wb25lbnRzL2FwaS5qcydcclxuZXhwb3J0IHtwbGFjZXNMaXN0LCBwb3B1cFByb2ZpbGUsIHBvcHVwTmV3Q2FyZCwgcG9wdXBBdmF0YXJ9XHJcblxyXG5cclxuY29uc3QgcGxhY2VzTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wbGFjZXNfX2xpc3QnKTtcclxuXHJcbmNvbnN0IHBvcHVwUHJvZmlsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF90eXBlX2VkaXQnKTtcclxuY29uc3QgcG9wdXBOZXdDYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX3R5cGVfbmV3LWNhcmQnKTtcclxuY29uc3QgcG9wdXBBdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfdHlwZV9hdmF0YXInKTtcclxuXHJcbmNvbnN0IG9wZW5Qcm9maWxlRWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19lZGl0LWJ1dHRvbicpO1xyXG5jb25zdCBvcGVuUHJvZmlsZUFkZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19hZGQtYnV0dG9uJyk7XHJcblxyXG5vcGVuUHJvZmlsZU1vZGFsKG9wZW5Qcm9maWxlRWRpdEJ1dHRvbiwgcG9wdXBQcm9maWxlLCB2YWxpZGF0aW9uRWxlbWVudHMsIHByb2ZpbGVGb3JtRWxlbWVudCk7XHJcbm9wZW5BZGRDYXJkTW9kYWwob3BlblByb2ZpbGVBZGRCdXR0b24sIHBvcHVwTmV3Q2FyZCwgdmFsaWRhdGlvbkVsZW1lbnRzLCBhZGRDYXJkRm9ybUVsZW1lbnQpO1xyXG5vcGVuUHJvZmlsZUF2YXRhck1vZGFsKHByb2ZpbGVJbWFnZSwgcG9wdXBBdmF0YXIsIHZhbGlkYXRpb25FbGVtZW50cywgYXZhdGFyRm9ybUVsZW1lbnQpO1xyXG5cclxucHJvZmlsZUZvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0KTtcclxuYWRkQ2FyZEZvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGhhbmRsZUZvcm1BZGRDYXJkU3VibWl0KTtcclxuYXZhdGFyRm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgaGFuZGxlQXZhdGFyRm9ybVN1Ym1pdCk7XHJcblxyXG4vL0FQSVxyXG5Qcm9taXNlLmFsbChbZ2V0VXNlckRhdGEoKSwgZ2V0Q2FyZHMoKV0pXHJcbiAgLnRoZW4oKFt1c2VyRGF0YSwgY2FyZHNdKSA9PiB7XHJcbiAgICBwcm9maWxlVGl0bGUudGV4dENvbnRlbnQgPSB1c2VyRGF0YS5uYW1lO1xyXG4gICAgcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50ID0gdXNlckRhdGEuYWJvdXQ7XHJcbiAgICBwcm9maWxlSW1hZ2Uuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gYHVybCgnJHt1c2VyRGF0YS5hdmF0YXJ9JylgXHJcbiAgICBjb25zdCBjdXJyZW50VXNlcklkID0gdXNlckRhdGEuX2lkO1xyXG4gICAgXHJcbiAgICBjYXJkcy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICBwbGFjZXNMaXN0LmFwcGVuZChjcmVhdGVDYXJkKGl0ZW0sIGRlbGV0ZUNhcmQsIGxpa2VDYXJkLCBvcGVuSW1hZ2VNb2RhbCwgY3VycmVudFVzZXJJZCkpXHJcbiAgICB9KVxyXG4gIH0pXHJcbiAgLmNhdGNoKGVyciA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gIH0pXHJcblxyXG4gIGVuYWJsZVZhbGlkYXRpb24odmFsaWRhdGlvbkVsZW1lbnRzKTtcclxuXHJcbiJdLCJuYW1lcyI6WyJfX3dlYnBhY2tfcmVxdWlyZV9fIiwiZXhwb3J0cyIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImNvbmZpZyIsImJhc2VVcmwiLCJoZWFkZXJzIiwiYXV0aG9yaXphdGlvbiIsImNhcmRUZW1wbGF0ZSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImNvbnRlbnQiLCJjcmVhdGVDYXJkIiwiaXRlbSIsImRlbGV0ZUNhcmQiLCJsaWtlQ2FyZCIsIm9wZW5JbWFnZU1vZGFsIiwiY3VycmVudFVzZXJJZCIsImNhcmRFbGVtZW50IiwiY2xvbmVOb2RlIiwiY2FyZEltYWdlIiwiY2FyZFRpdGxlIiwibW9kYWxJbWFnZSIsImNhcmROdW1iZXJPZkxpa2VzIiwiZGVsZXRlQnV0dG9uIiwiY2FyZExpa2VCdXR0b24iLCJvd25lciIsIl9pZCIsImhpZGRlbiIsInNyYyIsImxpbmsiLCJhbHQiLCJuYW1lIiwidGV4dENvbnRlbnQiLCJsaWtlcyIsImxlbmd0aCIsImNhcmRJZCIsInNvbWUiLCJsaWtlIiwiY2xhc3NMaXN0IiwiYWRkIiwiYWRkRXZlbnRMaXN0ZW5lciIsImNvbnRhaW5zIiwiZmV0Y2giLCJjb25jYXQiLCJtZXRob2QiLCJ0aGVuIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsInJlbW92ZUxpa2UiLCJyZW1vdmUiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJhZGRMaWtlIiwiY2FyZCIsImRlbGV0ZUNhcmRSZXF1ZXN0IiwicG9wdXBzIiwicXVlcnlTZWxlY3RvckFsbCIsInByb2ZpbGVGb3JtRWxlbWVudCIsImZvcm1zIiwibmFtZUlucHV0IiwiZWxlbWVudHMiLCJqb2JJbnB1dCIsImRlc2NyaXB0aW9uIiwicHJvZmlsZVRpdGxlIiwicHJvZmlsZURlc2NyaXB0aW9uIiwicHJvZmlsZUltYWdlIiwiYWRkQ2FyZEZvcm1FbGVtZW50IiwibGlua0lucHV0IiwicGxhY2VOYW1laW5wdXQiLCJhdmF0YXJGb3JtRWxlbWVudCIsImxpbmtBdmF0YXJpbnB1dCIsImF2YXRhciIsInZhbGlkYXRpb25FbGVtZW50cyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiaGlkZUlucHV0RXJyb3IiLCJmb3JtRWxlbWVudCIsImlucHV0RWxlbWVudCIsImVycm9yRWxlbWVudCIsImlkIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpc3QiLCJidXR0b25FbGVtZW50IiwidmFsaWRpdHkiLCJ2YWxpZCIsImhhc0ludmFsaWRJbnB1dCIsImRpc2FibGVkIiwiY2xlYXJWYWxpZGF0aW9uIiwiQXJyYXkiLCJmcm9tIiwiZm9yRWFjaCIsImJ1dHRvbkluYWN0aXZlIiwiaW1hZ2UiLCJtb2RhbCIsIm1vZGFsT3BlbiIsIm1vZGFsQ2xvc2VFc2MiLCJtb2RhbENsb3NlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImV2ZW50Iiwib3BlbmVkUG9wdXAiLCJyZW5kZXJMb2FkaW5nIiwiYnV0dG9uIiwiaXNMb2FkaW5nIiwidGFyZ2V0IiwiY3VycmVudFRhcmdldCIsInBsYWNlc0xpc3QiLCJwb3B1cFByb2ZpbGUiLCJwb3B1cE5ld0NhcmQiLCJwb3B1cEF2YXRhciIsIm9wZW5Qcm9maWxlRWRpdEJ1dHRvbiIsIm9wZW5Qcm9maWxlQWRkQnV0dG9uIiwidmFsdWUiLCJvcGVuUHJvZmlsZU1vZGFsIiwicmVzZXQiLCJvcGVuQWRkQ2FyZE1vZGFsIiwib3BlblByb2ZpbGVBdmF0YXJNb2RhbCIsImFib3V0IiwicHJldmVudERlZmF1bHQiLCJzdWJtaXR0ZXIiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImZpbmFsbHkiLCJuZXdDYXJkIiwicHJlcGVuZCIsInN0eWxlIiwiYmFja2dyb3VuZEltYWdlIiwiYWxsIiwiX3JlZiIsIl9yZWYyIiwidXNlckRhdGEiLCJjYXJkcyIsImFwcGVuZCIsInBhdHRlcm5NaXNtYXRjaCIsInNldEN1c3RvbVZhbGlkaXR5IiwiZGF0YXNldCIsImVycm9yTWVzc2FnZSIsInNob3dJbnB1dEVycm9yIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJjaGVja0lucHV0VmFsaWRpdHkiLCJzZXRFdmVudExpc3RlbmVycyIsImVuYWJsZVZhbGlkYXRpb24iXSwic291cmNlUm9vdCI6IiJ9